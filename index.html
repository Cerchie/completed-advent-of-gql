<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Image Generator</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>
  </head>
  <body class="flex justify-center items-center h-screen">
    <form
      action="/"
      method="POST"
      x-data="await Form()"
      @submit.prevent="submitData"
    >
      <div class="max-w-sm rounded overflow-hidden shadow-lg">
        <img
          class="w-full"
          x-bind:src="message"
          alt="Sunset in the mountains"
        />
        <div class="px-6 py-4">
          <div class="font-bold text-xl mb-2">Happy Advent of GraphQL!</div>
          <p class="text-gray-700 text-base">
            Generate a random image from Unsplash.

            <button
              class="
                bg-blue-500
                hover:bg-blue-700
                text-white
                font-bold
                py-2
                px-4
                rounded
                mt-2
              "
            >
              Submit
            </button>
          </p>
        </div>

        <div class="px-6 pt-4 pb-2"></div>
      </div>
    </form>
    <!-- AlpineJS logic begins here  -->
    <script>
            let queryString = `query MyQuery {
        unsplash_Random_Photo {
          urls {
            full
          }
        }
      }`
           let queryBody = { query: queryString }

            async function Form() {

              return {
                formData: {
                  object: "Root",
                  prefix: "",
                  json: "",
                },
                message: "",
                loading: false,
                buttonLabel: "Submit",

                submitData() {
                  const j = JSON.stringify(editor.get());
                  this.buttonLabel = "Submitting...";
                  this.loading = true;
                  this.message = "";
                  const body = JSON.stringify({
                    operationName: "MyQuery",
                    query: queryBody,
                    variables: {
                      json: j,
                      type: this.formData.object,
                      prefix: this.formData.prefix,
                    },
                  });
                 const result = await axios.post('/api/unsplash', queryBody).then((res) => { console.log(res.data)}),
                 return result;
                }
              };
            }
    </script>
  </body>
</html>
